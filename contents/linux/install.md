# Ubuntu インストール (2018)
今回は、GNU/Linux というOS（オペレーティングシステム）の一種である、Ubuntuの、バージョン18.04 LTS（2018年4月、長期サポート版）をインストールします。
## Windowsでの準備
### 「高速スタートアップ」の無効化
この機能が有効になっていると、常に Windowsが起動してしまい、Ubuntuと切り替えて使うことができなくなってしまうようなので、無効化します。実習用PCでは、無効化しても起動スピードはさほど変わりません。

1. 左下の検索ボックス（「ここに入力して検索」と書いてあるところ）に「コントロールパネル」と入力して、コントロールパネルを開きます。
2. 「ハードウェアとサウンド」をクリックします。
3. 「電源オプション」をクリックします。
4. 左部の「電源ボタンの動作を選択する」をクリックします。
5. 「現在利用可能ではない設定を変更します」をクリックします。
6. 「高速スタートアップを有効にする (推奨)」のチェックを外し、右下の「変更を保存」ボタンをクリックします。

### ドライブに空きスペースを作る
現時点では、SSDの全ての保存領域がWindowsのために確保されています。この領域を縮小して、Ubuntuをインストールするための空きスペースを確保します。

1. 画面左下の窓マークを右クリックして、「ディスクの管理(K)」を開きます。
2. ウィンドウ下半分は、ドライブがどう分割されているかを示しています。このなかの、「(C:)」と表示されている部分を右クリックし、「ボリュームの縮小 (H)...」を選択します。
![part1](photos/part1.PNG)
4.  しばらくすると、「C: の縮小」というウィンドウが表示されます。「縮小する領域のサイズ (MB)」のところに、40000 と入力します。40,000MB、つまり約40GBを、Ubuntu Linux のために確保することにします。
	- ほかの欄の数字は、この画像とは異なるかもしれません。これは、aマシンとbマシンとで、SSDの合計容量が異なるためです。
![part2](photos/part2.PNG)
5. 「縮小」ボタンをクリックします。
6. 次図のように、「未割り当て」と書かれた領域ができていれば、成功です。
![part3](photos/part3.PNG)

## BIOS での準備
### Secure Boot の設定
いまのSecure Boot の設定ではインストーラがうまく起動しないので、BIOSで変更します。画像はすべてaマシンのものですが、bマシンも基本的に同じです。

1. Windows をシャットダウンします。
2. 電源を入れる前に、USBメモリをUSBポートへ差し込みます。
	- 青色のポートの方を推奨します。
3. 電源を入れ、F2もしくはDeleteを連打し、BIOSの設定画面に入ります。
4. 右下の「Advanced Mode(F7)」をクリックします。
![bios1](photos/IMG_9458.jpg)
5. 「Boot」タブに飛び、「Secure Boot」をクリックします。
	- bマシンでは「Boot」が「起動」に、「Secure Boot」は「セキュアブート」になっています。
![bios2](photos/IMG_9463.jpg)
6. aマシンでは「OS Type」を「Other OS」に、bマシンでは「OSタイプ」を「非UEFIモード」に変えます。
![bios3](photos/IMG_9466.jpg)
7. 「EzMode(F7)」をクリックし、「BootMenu(F8)」から、「UEFI: USB SanDisk Extreme...」をクリックします。 これにより、インストーラーが起動します。
	- bマシンでは「BootMenu(F8)」は「ブートメニュー(F8)」になっています。
	- 画像では名前が異なっていますが、「UEFI」と「SanDiskExtreme」両方が入っている項目を選んでください。不安だったらTAに訊いてください。
![bios4](photos/IMG_9471.jpg)

## Ubuntu インストール
いよいよ、Ubuntuのインストールに入ります。

1. 次のような画面が出るので、キーボードの下矢印を押し、「Install Ubuntu」を選択して、Enterで決定します。放置したまま一定時間が過ぎると別のメニューが選択されてしまうので、要注意。
![ubuntu0](photos/IMG_9490.jpg)
2. 「ubuntu」というロゴが表示されたあとに、インストール画面が表示されます。
3. 「日本語」が選択されていることを確認し、「続ける」をクリックします。
![ubuntu1](photos/IMG_9472.jpg)
4. キーボードレイアウトが画像のようになっていることを確認して、「続ける」をクリックします。
![ubuntu2](photos/IMG_9473.jpg)
5. 「通常のインストール」が選択されていることを確認し、続けるをクリックします。
![ubuntu3](photos/IMG_9474.jpg)
6. 既にインストールされているWindowsをどうするか訊かれるので、「UbuntuをWindows Boot Managerとは別にインストール」を選択して、「インストール(I)」ボタンを押します。
	- もしこの選択肢が出なければ TA に相談してください。
![ubuntu4](photos/IMG_9475.jpg)
7. ディスクに変更を書き込みますか？」と訊かれるので、「続ける」を押します。画像中のディスクの名前（/dev/nvme0n1...の部分）やパーティション番号は、実際とは異なるかもしれません。
	- 先ほど作った空き領域（パーティション）を、ext4というLinux用の形式で初期化することを示しています。
![ubuntu5](photos/IMG_9476.jpg)
8. 「どこに住んでいますか？」と訊かれるので、「Tokyo」になっていることを確認して、「続ける」をクリックします。
9. あなたの情報を入力してください」と表示されますが、**ここでTAを呼んで**、TA用アカウントのパスワードを入力してもらってください。TAは「あなたの名前」のところに「TA」と入力し、あとは補完されたコンピュータ名やユーザ名を使えばよいです。
![ubuntu6](photos/IMG_9477.jpg)
10. 「続ける」を押すと、インストール作業が始まります。終わるまで待ちます。
![ubuntu7](photos/IMG_9478.jpg)
11. 「インストールが完了しました」ダイアログが出ればOKです。「今すぐ再起動する」をクリックします。再起動したらUSBメモリを抜いて、TAに返却してください。
![ubuntu8](photos/IMG_9479.jpg)



## Ubuntuの起動と初期設定
再起動すると、次のような画面が表示されます。この画面で、UbuntuとWindowsを選択できます。そのままUbuntuを選択してください。
![ubuntu9](photos/IMG_9480.jpg)
Ubuntuが立ち上がると TA のアカウントへのログイン待ちになります。ここで TA を呼んでパスワードを入力させてください。
![ubuntu10](photos/IMG_9481.jpg)


ログインに成功するとこのようなデスクトップ画面が表示されます。（「不完全な言語サポート」は、最初は表示されないかもしれません）
![ubuntu11](photos/ubuntu11.png)
「Ubuntuの新機能」は適当に読み進めてください。「Ubuntuの改善を支援する」項目は、支援したい場合には「はい」を選んでください。
![ubuntu12](photos/ubuntu12.png)
### 初期設定
初期設定をします。まず受講生アカウントを作り、管理者権限を付与します。その後、プロキシ設定をした後、システムの更新を行います。

- このあと、「不完全な言語サポート」というウインドウが表示されるかと思いますが、後の [`apt`のプロキシ設定](#apt_proxy)が済むまで放置してください。

#### アカウント作成

1. 右上の電源マークをクリックし、「TA」を押すと「アカウント設定」という項目があるので、それをクリックします。
2. 右上の「ロック解除」をクリックします。ここでTAのパスワードを求められるので、TAを呼んでパスワードを入力してもらってください。
![ubuntu13](photos/ubuntu13.png)
3. 右上の「ユーザーの追加(A)」をクリックします。
4. 「アカウントの種類」を「管理者」に変え、パスワードのチェックボックスを「いまパスワードを設定する(N)」に変え、ユーザー名、パスワード等を記入してください。
![ubuntu14](photos/ubuntu14.png)
5. 記入ができたら、右上の「追加(A)」をクリックします。これでアカウントが作成できました。
6. 再び右上の電源マークをクリックし、「TA」、「ログアウト」でログアウトします。
7. 今作った自分のアカウントでログインしてください。このアカウントが今後のLinux実習で使うアカウントになります。

#### プロキシ設定とCUIによるアップデート
##### ユーザーのプロキシ設定
1. プロキシ設定をします。まず、右上の電源マークを押し、その左下の工具箱マークを押します。すると、「設定」が開きます。
![proxy1](photos/proxy1.png)
2. 左下の「ネットワーク」をクリックし、次のように編集します
![proxy2](photos/proxy2.png)

　「次のホストを無視する(I)」に `*.ks.prv`を追加するのを忘れずに！
 
3. ウェブブラウザ(FireFox)を用いて、ネットワークに接続できるか確認してください。

<a name="apt_proxy"></a>
##### `apt`のプロキシ設定
次に、アップデートマネージャーコマンド`apt`用のプロキシ設定を行います。**Ctrl + Alt + T**の3つのキーを同時押しします。このショートカットはターミナルと呼ばれるプログラムを呼び出します。

ターミナルの詳しい使い方は今後の Unix/Linux 実習で学んでもらうとして、いまはとりあえず下の指示通りにコマンドを打ち込みましょう。

次のコマンドを打ち込みます。

```ShellSession
$ sudo nano /etc/apt/apt.conf
```

非常に間違えやすいところですが、**行頭の「$」は実際には入力しないでください**。実際には入力しないプロンプトをコマンドの行頭に書くのが慣習です。実行ユーザの権限を明確にするためにこうしています。

コマンド実行時にパスワードが求められますので、アカウント作成のときに設定したパスワードを入力します。このとき、入力している情報は**何も表示されません**。ですが、入力を受け付けていないわけではないので、パスワードを入力してエンターキーを押しましょう。

すると、テキストエディタが開くので、下の通りに編集し、Ctrl+Oで書き込んだ後、Ctrl+Xで終了します。

```
Acquire::ftp::proxy "ftp://cache.ks.prv:8080/";
Acquire::http::proxy "http://cache.ks.prv:8080/";
Acquire::https::proxy "https://cache.ks.prv:8080/";
```

- この設定が終わった後、「不完全な言語サポート」ウインドウが出たときに、「この操作を今すぐ実行する(R)」をクリックしてください。

##### `apt`を使ったアップデート
`apt`を用いたアップデートをします。テストインストールにおいて何故か`snapd`の設定がうまく行かなかったので、まず次を実行します。

```ShellSession
$ sudo apt remove snapd
```

次のコマンドを一つづつ打ちます。

```ShellSession
$ sudo apt update
$ sudo apt dist-upgrade
```
以上でアップデートが終わりました。

これですべての設定が終わりました。[LinuxTips](linuxtips.md)を読んだり、[Linux標準教科書ダウンロード](linuxtexts.md)に進んでPDFをダウンロードし、読み進めていってください。
