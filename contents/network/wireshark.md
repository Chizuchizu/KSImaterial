# wireshark

## 何をするもの？
Wiresharkは、ネットワークを流れるデータを取得、解析してその内容を表示するソフトウェアです。

ネットワークで送受信されるデータには、本来送りたいデータ（テキスト、音声、動画等）に加え、宛先や誤り訂正のための符号等を含む、
多種多様な制御情報が付加されています。
Wiresharkはその制御情報を解析し、見やすいように表示する機能を持っています。
ネットワーク管理者はもとより、サーバ運用やトラブルシューティングには不可欠の道具です。
Linux, MacOS, 各種Unixの他Windowsでも動作します。なお、Windowsでは同様のことを行うMicrosoft Network Monitorというソフトウェアもあります。

なお、ネットワークを流れるデータを取り込むことを「キャプチャする」と言います。

## 注意
東京大学情報セキュリティポリシー実施手順（一般操作機器・端末編）には、「自端末宛以外のパケットを傍受するアプリケーション（パケットスニファ等）を利用してはならない」等の規定があります。

Wiresharkはここで言う「自端末宛以外のパケットを傍受するアプリケーション」に該当します。

204号室に設置されている実習用PCは実験・実習用機器で、一般操作端末ではないと解されるし、教育・研究目的で対象とするネットワークの管理者が許可したものでもあるので、その上でWiresharkを動かすのは問題ありません。
しかし、自分のノートPCをUTokyo-Wifiに接続してWiresharkを動作させるのは上記規定に抵触しますので行わないでください。

## インストール
Wiresharkをインストールして使えるようにする。

Linuxでは、例によって
```
$ sudo apt-get install wireshark
```
で必要なファイルをインストールする。

なお、開発・配布元のWebページ http://www.wireshark.org/ も見ておくこと。 Windows版バイナリはここでダウンロードできる。

## 起動
Unix/LinuxではWiresharkを起動するのにroot特権が必要なので、
```
$ sudo DISPLAY=:0 XAUTHORITY=$XAUTHORITY wireshark
```
自分のパスワードを入力するとwiresharkが起動し、ウィンドウが一つ開く。
"This could be dangerous."というwarningのダイアログボックスが開くかもしれないが、当面やむを得ない。OKしておく。
以後、このウィンドウ内で操作する。

## キャプチャ開始
1. 主画面左側に"Capture"という欄があり、その下にネットワークインターフェイス名が並んでいる。
1. eth0をクリックすると、直ちにキャプチャが始まり、データが表示され始める。
1. 止めるときには、ひだりから４つめの、赤丸にxがついているアイコンをクリックする。
1. 再開するには、左から３つめのアイコンをクリックする。ダイアログボックスが出るが、特に必要がなければ"Continue without Saving"を選べばよい。
1. 中程のパネルにどんどん表示されていた一行一行がデータの固まり（フレーム）に対応している。
1. 適当な行を選び、クリックすると、一番下のパネルにフレームの内容の詳細が表示される。
1. 左側に１バイト毎のデータを16進数で表したものが並び、その中でASCIIコード（英数字記号等）と解釈できるものについて右側に対応する表示が出ている。
1. よく見ると読み取れる文字列が並んでいることに気づくはず。
1. ただし、実習用PCはすべて204号室内実習用ネットワークに接続されていて、
このネットワークは実習専用でよけいなものがつながっておらず「静か」なので、なかなか増えないかもしれない。

## Web
1. キャプチャを行いながら、Webブラウザを起動し、適当なページを表示する。どのようなデータが表示されるか？
1. 適当なフレームを選び、内容の詳細を表示させてみると、HTTPプロトコル、HTMLのデータが流れていることが確認できる。

## Packet Filter
単純にキャプチャしたのではデータが多すぎる場合、 設定した条件に合うフレームのみをキャプチャする機能がある。

左から２つ目のアイコンをクリックし、Capture Optionsを設定することで絞り込むことができる。

## 保存
キャプチャしたデータはファイルに保存しておくことができる。

不正アクセスに対処するとき、ネットワークの挙動がおかしいとき、様々な場合に保存したキャプチャデータが活用される。

逆に、保存が不要な場合は、Startを選択した際やWiresharkを終了する際に現れるダイアログで Continue without Savingを選べばよい。
